#!/bin/sh
set -e

if [ -n "$SKIP_CHANGELOG" ]; then
  exit 0
fi

MSG_FILE="$1"
if [ -z "$MSG_FILE" ] || [ ! -f "$MSG_FILE" ]; then
  exit 0
fi

SUBJECT=$(grep -v '^[[:space:]]*#' "$MSG_FILE" | head -n 1 | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
if [ -z "$SUBJECT" ]; then
  exit 0
fi

python3 .github/scripts/append_changelog_entry.py --subject "$SUBJECT"
git add CHANGELOG.md
